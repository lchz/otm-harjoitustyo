<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CourseService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Kurssien_seurantajarjestelma</a> &gt; <a href="index.source.html" class="el_package">otm.kurssien_seurantajarjestelma.domain</a> &gt; <span class="el_source">CourseService.java</span></div><h1>CourseService.java</h1><pre class="source lang-java linenums">package otm.kurssien_seurantajarjestelma.domain;

import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;
import otm.kurssien_seurantajarjestelma.dao.CourseDao;
import otm.kurssien_seurantajarjestelma.dao.UserDao;

/**
 * Sovelluslogiikasta vastaava luokka
 * 
 */

public class CourseService {
    private CourseDao courseDao;
    private UserDao userDao;
    private User loggedIn;
    
<span class="nc" id="L19">    public CourseService(CourseDao courseDao, UserDao userDao) {</span>
<span class="nc" id="L20">        this.userDao = userDao;</span>
<span class="nc" id="L21">        this.courseDao = courseDao;</span>
<span class="nc" id="L22">    }</span>
    
    /**
     * sisäänkirjautuminen
     * 
     * @param  username  käyttäjätunnus
     * 
     * @return true jos käyttäjätunnus on olemassa ja salasana on oikein, 
     *            muuten false
     */
    
    public boolean login(String username, String password) {
<span class="nc" id="L34">        User user = userDao.findByUsername(username);</span>
<span class="nc bnc" id="L35" title="All 2 branches missed.">        if(user == null) {</span>
<span class="nc" id="L36">            return false;</span>
        }
        
<span class="nc bnc" id="L39" title="All 2 branches missed.">        if(!user.getPassword().equals(password)) {</span>
<span class="nc" id="L40">            return false;</span>
        }
        
<span class="nc" id="L43">        loggedIn = user;</span>
        
<span class="nc" id="L45">        return true;</span>
    }
    
    /**
     * kirjautuneena oleva käyttäjä
     * 
     * @return kirjautuneena oleva käyttäjä
     */
    
    public User getLoggedUser() {
<span class="nc" id="L55">        return loggedIn;</span>
    }
    
    /**
     * uloskirjautuminen
     */
    
    public void logout() {
<span class="nc" id="L63">        loggedIn = null;</span>
<span class="nc" id="L64">    }</span>
    
    /**
     * uuden käyttäjän luominen
     * 
     * @param  Username  käyttäjätunnus
     * @param  name  käyttäjän nimi
     * @param  email  käyttäjän sähköposti
     * @param  password  käyttäjän salasana
     * 
     * @return true jos käyttäjätunnus on luotu onnistuneesti, muuten false
     */
    
    public boolean createUser(String username, String name, String email, String password) {
<span class="nc bnc" id="L78" title="All 2 branches missed.">        if(userDao.findByUsername(username) != null) {</span>
<span class="nc" id="L79">            return false;</span>
        }
        
<span class="nc bnc" id="L82" title="All 2 branches missed.">        if(userDao.findByName(name) != null) {</span>
<span class="nc" id="L83">            return false;</span>
        }
        
<span class="nc" id="L86">        int id = userDao.getAll().size() + 1;</span>
<span class="nc" id="L87">        User user = new User(id, name, username, email, password);</span>
        
        try {
<span class="nc" id="L90">            userDao.create(user);</span>
            
<span class="nc" id="L92">        } catch(Exception e) {</span>
<span class="nc" id="L93">            return false;</span>
<span class="nc" id="L94">        }</span>
        
<span class="nc" id="L96">        return true;</span>
    }
    
    
    /**
     * Uuden kurssin lisääminen kirjautuneena olevalle käyttäjälle
     * @param   content   luotavan kurssin sisältö
     */
    
    public boolean createCourse(String content) {
<span class="nc" id="L106">        Course course = new Course(content, loggedIn);</span>
        
        try {
<span class="nc" id="L109">            courseDao.create(course);</span>
            
<span class="nc" id="L111">        } catch(Exception e) {</span>
            
<span class="nc" id="L113">            return false;</span>
<span class="nc" id="L114">        }</span>
        
<span class="nc" id="L116">        return true;</span>
    }
    
    /**
     * kirjautuneen käyttäjän tekemättömät kurssit
     * 
     * @return kirjautuneen käyttäjän tekemättömät kurssit
     */
    
    public List&lt;Course&gt; getUnfinished() {
<span class="nc bnc" id="L126" title="All 2 branches missed.">        if(loggedIn == null) {</span>
<span class="nc" id="L127">            return new ArrayList&lt;&gt;();</span>
        }
        
<span class="nc" id="L130">        return courseDao.getAll()</span>
<span class="nc" id="L131">                .stream()</span>
<span class="nc" id="L132">                .filter(c -&gt; c.getUser().equals(loggedIn))</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">                .filter(c -&gt; !c.isFinished())</span>
<span class="nc" id="L134">                .collect(Collectors.toList());</span>
    }
    
    /**
     * kurssin merkitsminen päätydyksi
     * 
     * @param  id  päätydyksi merkittävän kurssin tunniste
     */
    
    public void markFinished(int id) {
        try {
<span class="nc" id="L145">            courseDao.setFinished(id);</span>
            
<span class="nc" id="L147">        } catch(Exception e) {</span>
            
<span class="nc" id="L149">        }</span>
<span class="nc" id="L150">    }</span>
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.0.201801022044</span></div></body></html>